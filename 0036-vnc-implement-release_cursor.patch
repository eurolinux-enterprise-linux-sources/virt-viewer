From 56cded6c5d687be21a1e098821dbc0f022f17673 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marc-Andr=C3=A9=20Lureau?= <marcandre.lureau@gmail.com>
Date: Mon, 8 Jul 2013 18:45:09 +0200
Subject: [PATCH] vnc: implement release_cursor()

Error reported in:
https://bugzilla.redhat.com/show_bug.cgi?id=904094

(cherry picked from commit 008779488b9fa315602f642c8643b3a5b12ea76b)
---
 src/virt-viewer-display-vnc.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/virt-viewer-display-vnc.c b/src/virt-viewer-display-vnc.c
index c0bcf13..32119bc 100644
--- a/src/virt-viewer-display-vnc.c
+++ b/src/virt-viewer-display-vnc.c
@@ -53,6 +53,14 @@ virt_viewer_display_vnc_finalize(GObject *obj)
 
 
 static void
+virt_viewer_display_vnc_release_cursor(VirtViewerDisplay *display)
+{
+    VirtViewerDisplayVnc *self = VIRT_VIEWER_DISPLAY_VNC(display);
+
+    vnc_display_force_grab(self->priv->vnc, FALSE);
+}
+
+static void
 virt_viewer_display_vnc_class_init(VirtViewerDisplayVncClass *klass)
 {
     VirtViewerDisplayClass *dclass = VIRT_VIEWER_DISPLAY_CLASS(klass);
@@ -63,6 +71,7 @@ virt_viewer_display_vnc_class_init(VirtViewerDisplayVncClass *klass)
     dclass->send_keys = virt_viewer_display_vnc_send_keys;
     dclass->get_pixbuf = virt_viewer_display_vnc_get_pixbuf;
     dclass->close = virt_viewer_display_vnc_close;
+    dclass->release_cursor = virt_viewer_display_vnc_release_cursor;
 
     g_type_class_add_private(klass, sizeof(VirtViewerDisplayVncPrivate));
 }
